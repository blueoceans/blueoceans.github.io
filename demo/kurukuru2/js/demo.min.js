"use strict";var animate,camera,config,config_path,controls,init,objects,onWindowResize,projector,render,renderer,scene,targets,transform;config_path="./config.yaml",config=void 0,camera=void 0,scene=void 0,renderer=void 0,controls=void 0,objects=void 0,projector=void 0,targets={table:[],sphere:[],helix:[],grid:[]},init=function(e){var t,n,o,a,i,r,c,s,l,d,m,h,p,g,u,f,E,w;for(r=e.object.space||20,e.object.distance=e.item.length*(e.object.width+r)/(2*Math.PI),e.camera._distance=e.object.distance+e.camera.distance,camera=new THREE.PerspectiveCamera(40,window.innerWidth/window.innerHeight,1,1e4),camera.position.set(0,e.camera.height,e.camera._distance),scene=new THREE.Scene,i=e.object.distance,c=e.object.variability.x,s=e.object.variability.y,l=e.object.variability.z,h=0,u=objects.length;u>h;h++)n=objects[h],d=2*Math.PI*Math.random(),n.position.x=Math.sin(d)*i*c,n.position.y=Math.sin(2*Math.PI*Math.random())*i*s,n.position.z=Math.cos(d)*i*l,scene.add(n),n=new THREE.Object3D,targets.table.push(n);if(!(targets.helix.length>0))for(m=p=0,E=objects.length;E>=0?E>=p:p>=E;m=E>=0?++p:--p)n=new THREE.Object3D,targets.helix.push(n);for(a=2*Math.PI/e.item.length,d=new THREE.Vector3,w=targets.helix,t=g=0,f=w.length;f>g;t=++g)n=w[t],o=t*a,n.position.x=e.object.distance*Math.sin(o),n.position.y=0,n.position.z=e.object.distance*Math.cos(o),d.x=2*n.position.x,d.y=n.position.y,d.z=2*n.position.z,n.lookAt(d);renderer=new THREE.CSS3DRenderer,renderer.setSize(window.innerWidth,window.innerHeight),renderer.domElement.style.position="absolute",document.getElementById("container").appendChild(renderer.domElement),controls=new THREE.TrackballControls(camera,renderer.domElement),controls.rotateSpeed=.5,controls.minDistance=e.object.distance,controls.maxDistance=12*e.object.distance,controls.addEventListener("change",render),transform(targets.helix,5e3),window.addEventListener("resize",onWindowResize,!1)},transform=function(e,t){var n,o,a,i,r,c;for(TWEEN.removeAll(),i=new THREE.Vector3,n=r=0,c=objects.length;c>r;n=++r)o=objects[n],a=e[n],i.x=0,i.y=0,i.z=1e4,o.lookAt(i),new TWEEN.Tween(o.position).to({x:a.position.x,y:a.position.y,z:a.position.z},Math.random()*t+t).easing(TWEEN.Easing.Exponential.InOut).start(),new TWEEN.Tween(o.rotation).to({x:a.rotation.x,y:a.rotation.y,z:a.rotation.z},Math.random()*t+t).easing(TWEEN.Easing.Exponential.InOut).start();new TWEEN.Tween(this).to({},2*t).onUpdate(render).onComplete(function(){}).start()},onWindowResize=function(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight),render()},animate=function(){requestAnimationFrame(animate),TWEEN.update(),controls.update()},render=function(){renderer.render(scene,camera)},angular.module("app",["app.controllers","app.directives"]).config(["$interpolateProvider",function(e){e.startSymbol("[["),e.endSymbol("]]")}]),angular.module("app.controllers",[]).controller("Ctrl",["$scope","$location","$log","$http","$timeout","$window",function(e,t,n,o,a,i){var r,c,s,l,d,m;s=0,o.get(config_path).success(function(t){var n;e.c=config=jsyaml.load(t),e.rotate=config.camera.rotate,null==e.$$phase&&e.$apply(),n=angular.element("#mask-img")[0],n.onload=function(){var t,o;r(),o=e.c.object.width,t=e.c.object.reflect||e.c.object.height,angular.forEach(angular.element(".element-canvas"),function(a){var i;a.width=o,a.height=t,a.style.width=""+o+"px",a.style.height=""+t+"px",i=a.parentNode.previousElementSibling,i.onload=function(){var t;t=a.getContext("2d"),t.clearRect(0,0,i.width,i.height),t.drawImage(i,0,0,i.width,i.height),t.globalCompositeOperation="xor",t.drawImage(n,0,0,i.width,i.height),s+=1,s>=e.c.item.length&&addReflections()}}),c()},a(function(){var t;objects=function(){var e,n,o,a;for(o=angular.element(".element"),a=[],e=0,n=o.length;n>e;e++)t=o[e],a.push(new THREE.CSS3DObject(t));return a}(),e.reset(),animate(),m()},200)}),c=function(){var e;e=angular.element(".element-canvas canvas:not(.reflected)"),e.length>0?$(e).addClass("ng-hide"):a(r,200)},r=function(){var e,t,n,o;if(t=angular.element(".element-canvas canvas:not(.reflected)"),t.length>0){for(n=0,o=t.length;o>n;n++)e=t[n],e.style.opacity=0,new TWEEN.Tween(e.style).to({opacity:1},2e3).delay(3e3).easing(TWEEN.Easing.Quadratic.In).start();$(t).removeClass("ng-hide")}else a(r,200)},l=0,e.reset=function(){l=0,e.rotate=config.camera.rotate,c(),init(e.c),r(),renderer.domElement.addEventListener("click",function(t){var n,o,r,c,s,m,h;o=t.toElement,("element-img"===(m=o.className)||"element-canvas"===m)&&(c=Number(o.getAttribute("data-nth")),s=null!=(h=e.c.item[c])?h[1]:void 0,r=e.c.item.length,n=Math.floor(r*l/(2*Math.PI)),Math.abs(c-n)>r/2&&(c+=r*(0>c-n?1:-1)),d(c),s&&a(function(){i.open(s)},e.c.efect.time+100))},!1)},e.zoom=function(t){new TWEEN.Tween(e.c.camera).to({_distance:e.c.camera._distance*t},e.c.efect.time).easing(TWEEN.Easing.Linear.None).onUpdate(function(){camera.position.x=Math.sin(l)*e.c.camera._distance,camera.position.z=Math.cos(l)*e.c.camera._distance}).onComplete(function(){e.mouseup||e.zoom(t)}).start()},m=function(){camera.lookAt(scene.position),a(m,40)},e.rotate_next=function(t){var n,o,a,i;o=e.rotate?0:-1,a=e.c.item.length,n=a*l/(2*Math.PI),i=Math.round(n)+("left"===t?o:1),d(i,t)},d=function(t,n){var o,i,r;i=e.c.object.height||200,camera.position.y%(i/2)!==0&&controls.reset(),e.rotate&&(e.rotate=!1),r=e.c.item.length,o=Math.floor(r*l/(2*Math.PI)),Math.abs(t-o)>r/2&&(t+=r*(0>t-o?1:-1)),new TWEEN.Tween({omega:l}).to({omega:2*Math.PI/r*t},e.c.efect.time).easing(TWEEN.Easing.Linear.None).onUpdate(function(){l=this.omega,camera.position.x=Math.sin(l)*e.c.camera._distance,camera.position.z=Math.cos(l)*e.c.camera._distance}).onComplete(function(){e.mouseup||a(function(){e.rotate_next(n)},40)}).start()},e.up=function(t){t||(t=(e.c.object.height||200)/2),new TWEEN.Tween(camera.position).to({y:camera.position.y+t},e.c.efect.time).easing(TWEEN.Easing.Linear.None).onComplete(function(){e.mouseup||e.up(t)}).start()},e.down=function(){e.up((e.c.object.height||200)/-2)}}]).controller("jmpress",["$scope","$location","$log","$http","$timeout","$window",function(e,t,n,o){return o.get(config_path).success(function(t){e.c=config=jsyaml.load(t),e.rotate=config.camera.rotate,null==e.$$phase&&e.$apply()})}]),angular.module("app.directives",[]).directive("jmpress",function(){return function(){jmpress_init()}}),angular.element(document).ready(function(){return angular.bootstrap(document,["app"])});